# Локальная оптимизация

Локальная оптимизация или метаэвристики — это альтернативный глобальному поиску подход к решению оптимизационных задач, для которых не представляется возможным получить точное решение (к примеру, NP-полные задачи).

![](https://upload.wikimedia.org/wikipedia/commons/c/c3/Metaheuristics_classification.svg)

Эти алгоритмы имеют частично недетерминированную природу, т.е. зависят от случайного выбора каких-то начальных параметров (локальный поиск) или же вероятностной природы принятия решений в процессе работы алгоритма (симуляция выплавки).


## Локальный поиск

В простейшем варианте подход локального поиска состоит в том, чтобы взять какое-то решение задачи (например, случайное) и пытаться улучшить его с помощью простых преобразований до тех пор, пока это возможно. Например, для задачи TSP простейшим методом улучшения является метод 2-opt, который удаляет 2 произвольных ребра из маршрута и заменяет их на другой вариант ребер, соединяющих вершины из этих ребер. Есть только один вариант такой замены. Например, если исходный маршрут был такой: `1 - 2 - 3 - 4 - 5`,— то замена ребер `1 - 2` и `4 - 5` приведет к новому маршруту: `1 - 4 - 3 - 2 - 5`.

Проблема локального поиска — это попадание в локальный оптимум.

## Симуляция выплавки

Один из вариант решения проблемы локальных оптимумов является подход Simulated annealing (Симуляция выплавки, иммитация отжига). Согласно ему текущий маршрут может меняться не обязательно на более оптимальный, но и (иногда) на менее оптимальный (с определенной вероятностью). Общая схема следующая:

1. Получить исходное решение
2. Рассмотреть случайную вариацию этого решения
3. Если вариация лучше, принять ее, если нет, то отбросить ее с вероятностью, которая зависит от разницы между оценкой текущего варианта и предыдущего, а также от итерации (чем больше номер итерации, тем больше вероятность отказаться).
4. Запоминание исторически самого лучшего результата, чтобы вернуться к нему в случае, если алгоритм пошел неверным путем (слишком долго не получается улучшить оптимальный результат).

У алгоритма много параметров, которые необходимо подстраивать для конкретной задачи:
- "график" (функцию) изменения вероятности
- метод семплирования (выбора) кандидата
- количество итераций до остановки или рестарта

## Семплирование

Семплирование — это создание случайной выборки из какого-то набора элементов, распределение которых известно. Для семплирования `n` элементов небходимо `n` раз применить метод семплирования одного элемента из множества. Такое семплирование может быть с или без ....

Простейшие подходы к семплированию:

1. Семплирование из набора `n` равномерно распределенных элементов — выбор элемента с индексом `random(n)`
2. Семплирование из набора `n` элементов, которые имеют разный вес (вероятность выбора). Такой набор можно преставить как список пар элемент-вес. Семплирование может быть выполнено проецированием всего набора в отрезок [0,1] так, что каждому элементу будет отдан подотрезок, размер которого пропорционален его вкладу в общий вес.

    Для набора из `n=4` элементов `a:2, b:1, c:5, d:2` отрезок будет иметь такой вид:

       0 .. a .. 0.2 .. b .. 0.3 .. c .. 0.8 .. d .. 1

    Далее для выбора случайного элментра генерируется случайное число в диапазоне от 0 до 1 и выбирается тот элемент, в отрезок которого попало это число.
3. Для семплирования из бесконечного набора элементов, который обрабатываетс послеовательно (как поток/stream), используется метод резервуарного емплирования (reservoir sampling). Он работает так же, как и предыдущие 2, только итеративно. При последовательной обработке бесконечного набора на первом шаге всегда выбирается первый и единственный элемент, на втором шаге с вероятностью 1/2 (для равномерного распределения) либо сохраняется выбранный элемент, либо он заменяется на второй. На n-ом шаге с вероятностью `1/n` выбирается новый элемент, а с вероятностью `(n-1)/n` сохраняется текущий.


## Литература

- https://en.wikipedia.org/wiki/Metaheuristic
- https://www.youtube.com/watch?v=SC5CX8drAtU
- https://www.reddit.com/r/dataisbeautiful/comments/2go0o6/the_shortest_path_through_the_48_continental 
- https://habrahabr.ru/post/209610/
- http://katrinaeg.com/simulated-annealing.html
- http://www.theprojectspot.com/tutorial-post/simulated-annealing-algorithm-for-beginners/6
- http://blog.cloudera.com/blog/2013/04/hadoop-stratified-randosampling-algorithm/
- https://www.quora.com/What-is-an-intuitive-explanation-of-reservoir-sampling
- https://cs.adelaide.edu.au/~markus/pub/2012lion.pdf
